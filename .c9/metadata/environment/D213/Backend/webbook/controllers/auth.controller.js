{"filter":false,"title":"auth.controller.js","tooltip":"/D213/Backend/webbook/controllers/auth.controller.js","undoManager":{"mark":13,"position":13,"stack":[[{"start":{"row":90,"column":1},"end":{"row":91,"column":0},"action":"insert","lines":["",""],"id":2},{"start":{"row":91,"column":0},"end":{"row":92,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":92,"column":0},"end":{"row":132,"column":1},"action":"insert","lines":["exports.login = function(req, res) {","    let email = req.body.email;","    let password = req.body.password;","    const query = connect.con.query('SELECT users.*,operational.id_operational FROM users,operational where users.email = ? and users.password =? and users.id=operational.id limit 1',[email, password], function(err, rows, fields) {","        if (err) {","            console.log(err);","            res.status(jsonMessages.db.noRecords.status).send(jsonMessages.db.dbError);","        }","        else {","            if (rows.length == 0) {","                res.status(jsonMessages.db.noRecords.status).send(jsonMessages.db.noRecords);","            }","            else {","                let user = JSON.parse(JSON.stringify(rows));","                //use the payload to store information about the user such as username, user role, etc.","                let payload = { email: email}","                let userData={","                 id_operational: user[0].id_operational,","                }","                res.cookie(\"userData\", userData); ","                //create the access token with the shorter lifespan","                let accessToken = jwt.sign(payload, process.env.ACCESS_TOKEN_SECRET, {","                    algorithm: \"HS256\",","                    expiresIn: process.env.ACCESS_TOKEN_LIFE","                })","                //create the refresh token with the longer lifespan","                let refreshToken = jwt.sign(payload, process.env.REFRESH_TOKEN_SECRET, {","                    algorithm: \"HS256\",","                    expiresIn: process.env.REFRESH_TOKEN_LIFE","                })","                ","                //store the refresh token in the user array","                user[0].email.refreshToken = refreshToken;","                //send the access token to the client inside a cookie","                res.cookie(\"jwt\", accessToken, { httpOnly: true})","                res.send(req.cookies.userData); ","                res.send();","            }","        }","    });","}"],"id":3}],[{"start":{"row":92,"column":8},"end":{"row":92,"column":13},"action":"remove","lines":["login"],"id":4},{"start":{"row":92,"column":8},"end":{"row":92,"column":9},"action":"insert","lines":["h"]},{"start":{"row":92,"column":9},"end":{"row":92,"column":10},"action":"insert","lines":["e"]},{"start":{"row":92,"column":10},"end":{"row":92,"column":11},"action":"insert","lines":["r"]},{"start":{"row":92,"column":11},"end":{"row":92,"column":12},"action":"insert","lines":["o"]},{"start":{"row":92,"column":12},"end":{"row":92,"column":13},"action":"insert","lines":["k"]},{"start":{"row":92,"column":13},"end":{"row":92,"column":14},"action":"insert","lines":["u"]}],[{"start":{"row":93,"column":4},"end":{"row":104,"column":18},"action":"remove","lines":["let email = req.body.email;","    let password = req.body.password;","    const query = connect.con.query('SELECT users.*,operational.id_operational FROM users,operational where users.email = ? and users.password =? and users.id=operational.id limit 1',[email, password], function(err, rows, fields) {","        if (err) {","            console.log(err);","            res.status(jsonMessages.db.noRecords.status).send(jsonMessages.db.dbError);","        }","        else {","            if (rows.length == 0) {","                res.status(jsonMessages.db.noRecords.status).send(jsonMessages.db.noRecords);","            }","            else {"],"id":5}],[{"start":{"row":119,"column":8},"end":{"row":119,"column":9},"action":"remove","lines":["}"],"id":6},{"start":{"row":119,"column":4},"end":{"row":119,"column":8},"action":"remove","lines":["    "]},{"start":{"row":119,"column":0},"end":{"row":119,"column":4},"action":"remove","lines":["    "]},{"start":{"row":118,"column":13},"end":{"row":119,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":119,"column":0},"end":{"row":119,"column":7},"action":"remove","lines":["    });"],"id":7},{"start":{"row":118,"column":13},"end":{"row":119,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":119,"column":0},"end":{"row":119,"column":1},"action":"remove","lines":["}"],"id":8}],[{"start":{"row":94,"column":15},"end":{"row":94,"column":60},"action":"remove","lines":[" let user = JSON.parse(JSON.stringify(rows));"],"id":9},{"start":{"row":94,"column":14},"end":{"row":94,"column":15},"action":"remove","lines":[" "]},{"start":{"row":94,"column":13},"end":{"row":94,"column":14},"action":"remove","lines":[" "]},{"start":{"row":94,"column":12},"end":{"row":94,"column":13},"action":"remove","lines":[" "]},{"start":{"row":94,"column":8},"end":{"row":94,"column":12},"action":"remove","lines":["    "]},{"start":{"row":94,"column":4},"end":{"row":94,"column":8},"action":"remove","lines":["    "]},{"start":{"row":94,"column":0},"end":{"row":94,"column":4},"action":"remove","lines":["    "]}],[{"start":{"row":93,"column":4},"end":{"row":94,"column":0},"action":"remove","lines":["",""],"id":10}],[{"start":{"row":94,"column":6},"end":{"row":94,"column":7},"action":"remove","lines":[" "],"id":11},{"start":{"row":94,"column":5},"end":{"row":94,"column":6},"action":"remove","lines":[" "]},{"start":{"row":94,"column":4},"end":{"row":94,"column":5},"action":"remove","lines":[" "]},{"start":{"row":94,"column":0},"end":{"row":94,"column":4},"action":"remove","lines":["    "]},{"start":{"row":93,"column":4},"end":{"row":94,"column":0},"action":"remove","lines":["",""]},{"start":{"row":93,"column":0},"end":{"row":93,"column":4},"action":"remove","lines":["    "]},{"start":{"row":92,"column":37},"end":{"row":93,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":92,"column":37},"end":{"row":92,"column":46},"action":"remove","lines":["         "],"id":12},{"start":{"row":92,"column":37},"end":{"row":93,"column":0},"action":"insert","lines":["",""]},{"start":{"row":93,"column":0},"end":{"row":93,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":95,"column":16},"end":{"row":97,"column":17},"action":"remove","lines":["let userData={","                 id_operational: user[0].id_operational,","                }"],"id":13},{"start":{"row":95,"column":12},"end":{"row":95,"column":16},"action":"remove","lines":["    "]},{"start":{"row":95,"column":8},"end":{"row":95,"column":12},"action":"remove","lines":["    "]},{"start":{"row":95,"column":4},"end":{"row":95,"column":8},"action":"remove","lines":["    "]},{"start":{"row":95,"column":0},"end":{"row":95,"column":4},"action":"remove","lines":["    "]},{"start":{"row":94,"column":45},"end":{"row":95,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":113,"column":13},"end":{"row":114,"column":0},"action":"remove","lines":["",""],"id":14}],[{"start":{"row":9,"column":183},"end":{"row":9,"column":184},"action":"insert","lines":[" "],"id":15},{"start":{"row":21,"column":44},"end":{"row":21,"column":45},"action":"insert","lines":[" "]},{"start":{"row":22,"column":28},"end":{"row":22,"column":29},"action":"insert","lines":[" "]},{"start":{"row":22,"column":30},"end":{"row":22,"column":31},"action":"insert","lines":[" "]},{"start":{"row":23,"column":0},"end":{"row":23,"column":3},"action":"insert","lines":["   "]},{"start":{"row":25,"column":49},"end":{"row":25,"column":50},"action":"remove","lines":[" "]},{"start":{"row":36,"column":0},"end":{"row":36,"column":16},"action":"remove","lines":["                "]},{"start":{"row":40,"column":63},"end":{"row":40,"column":64},"action":"insert","lines":[" "]},{"start":{"row":41,"column":47},"end":{"row":41,"column":48},"action":"remove","lines":[" "]},{"start":{"row":51,"column":144},"end":{"row":51,"column":145},"action":"insert","lines":[" "]},{"start":{"row":51,"column":154},"end":{"row":51,"column":155},"action":"insert","lines":[" "]},{"start":{"row":51,"column":170},"end":{"row":51,"column":171},"action":"insert","lines":[" "]},{"start":{"row":63,"column":62},"end":{"row":63,"column":63},"action":"insert","lines":[" "]},{"start":{"row":74,"column":0},"end":{"row":74,"column":16},"action":"remove","lines":["                "]},{"start":{"row":78,"column":74},"end":{"row":78,"column":75},"action":"insert","lines":[" "]},{"start":{"row":85,"column":30},"end":{"row":85,"column":31},"action":"insert","lines":[" "]},{"start":{"row":94,"column":4},"end":{"row":94,"column":16},"action":"remove","lines":["            "]},{"start":{"row":94,"column":32},"end":{"row":94,"column":33},"action":"insert","lines":[" "]},{"start":{"row":95,"column":0},"end":{"row":95,"column":12},"action":"remove","lines":["            "]},{"start":{"row":95,"column":37},"end":{"row":95,"column":38},"action":"remove","lines":[" "]},{"start":{"row":96,"column":4},"end":{"row":96,"column":16},"action":"remove","lines":["            "]},{"start":{"row":97,"column":4},"end":{"row":97,"column":16},"action":"remove","lines":["            "]},{"start":{"row":98,"column":8},"end":{"row":98,"column":20},"action":"remove","lines":["            "]},{"start":{"row":99,"column":0},"end":{"row":99,"column":12},"action":"remove","lines":["            "]},{"start":{"row":100,"column":4},"end":{"row":100,"column":16},"action":"remove","lines":["            "]},{"start":{"row":101,"column":4},"end":{"row":101,"column":16},"action":"remove","lines":["            "]},{"start":{"row":102,"column":0},"end":{"row":102,"column":12},"action":"remove","lines":["            "]},{"start":{"row":103,"column":8},"end":{"row":103,"column":20},"action":"remove","lines":["            "]},{"start":{"row":104,"column":0},"end":{"row":104,"column":12},"action":"remove","lines":["            "]},{"start":{"row":105,"column":4},"end":{"row":105,"column":16},"action":"remove","lines":["            "]},{"start":{"row":106,"column":0},"end":{"row":106,"column":16},"action":"remove","lines":["                "]},{"start":{"row":107,"column":4},"end":{"row":107,"column":16},"action":"remove","lines":["            "]},{"start":{"row":108,"column":4},"end":{"row":108,"column":16},"action":"remove","lines":["            "]},{"start":{"row":109,"column":0},"end":{"row":109,"column":12},"action":"remove","lines":["            "]},{"start":{"row":110,"column":4},"end":{"row":110,"column":16},"action":"remove","lines":["            "]},{"start":{"row":110,"column":51},"end":{"row":110,"column":52},"action":"insert","lines":[" "]},{"start":{"row":111,"column":4},"end":{"row":111,"column":16},"action":"remove","lines":["            "]},{"start":{"row":111,"column":35},"end":{"row":111,"column":36},"action":"remove","lines":[" "]},{"start":{"row":112,"column":4},"end":{"row":112,"column":16},"action":"remove","lines":["            "]},{"start":{"row":113,"column":0},"end":{"row":113,"column":12},"action":"remove","lines":["            "]},{"start":{"row":113,"column":1},"end":{"row":114,"column":0},"action":"insert","lines":["",""]}]]},"ace":{"folds":[],"scrolltop":1425,"scrollleft":0,"selection":{"start":{"row":100,"column":6},"end":{"row":100,"column":6},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1611510460271,"hash":"6ebddc5db61475f8f5f14e4522de843c80cef5dd"}