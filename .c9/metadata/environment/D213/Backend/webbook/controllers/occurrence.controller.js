{"filter":false,"title":"occurrence.controller.js","tooltip":"/D213/Backend/webbook/controllers/occurrence.controller.js","undoManager":{"mark":34,"position":34,"stack":[[{"start":{"row":81,"column":0},"end":{"row":105,"column":3},"action":"remove","lines":["//efetuar updade de todos os dados para um determinado iduser","/*function updateOccurrence(req, res) {","    //receber os dados do formuário que são enviados por post","    const arrival = req.sanitize('arrival').escape();","    const departure = req.sanitize('departure').escape();","    const status = req.sanitize('status').escape();","    let query = \"\";","    let post = {","        arrival: arrival,","        departure: departure,","        status: status,","    };","    query = connect.con.query('update ?? SET arrival=?, departure=?, status =?, 'occurrence' ok meu amigo ta pago, post, function(err, rows,","        fields) {","        console.log(query.sql);","        if (!err) {","            console.log(\"Number of records updated: \" + rows.affectedRows);","            res.status(200).send({ \"msg\": \"update with success\" });","        }","        else {","            res.status(400).send({ \"msg\": err.code });","            console.log('Error while performing Query.', err);","        }","    });","}*/"],"id":2},{"start":{"row":80,"column":0},"end":{"row":81,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":80,"column":0},"end":{"row":81,"column":0},"action":"remove","lines":["",""],"id":3}],[{"start":{"row":902,"column":0},"end":{"row":902,"column":41},"action":"remove","lines":["    //updateOccurrence: updateOccurrence,"],"id":4},{"start":{"row":901,"column":39},"end":{"row":902,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":85,"column":0},"end":{"row":85,"column":53},"action":"remove","lines":["    //const status = req.sanitize('status').escape();"],"id":5},{"start":{"row":84,"column":65},"end":{"row":85,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":104,"column":0},"end":{"row":104,"column":53},"action":"remove","lines":["    //const status = req.sanitize('status').escape();"],"id":6},{"start":{"row":103,"column":65},"end":{"row":104,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":122,"column":0},"end":{"row":122,"column":53},"action":"remove","lines":["    //const status = req.sanitize('status').escape();"],"id":7},{"start":{"row":121,"column":65},"end":{"row":122,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":137,"column":0},"end":{"row":162,"column":2},"action":"remove","lines":["//função que apaga todos os dados de um iduser","/*function deleteIDOccurrence(req, res) { // nao deve ser preciso","    //criar e executar a query de leitura na BD","    const id_occurrence = req.sanitize('id_occurrence').escape();","    const post = {","        id_occurrence: id_occurrence","    };","    connect.con.query('DELETE from ?? where id_occurrence = ?', 'occurrence', post, function(err, rows, fields) {","        if (!err) {","            //verifica os resultados se o número de linhas for 0 devolve dados não encontrados, caso contrário envia os resultados (rows).","            if (rows.length == 0) {","                res.status(404).send({","                    \"msg\": \"data not found\"","                });","            }","            else {","                res.status(200).send({","                    \"msg\": \"success\"","                });","            }","        }","        else","            console.log('Error while performing Query.', err);","    });","}","*/"],"id":9},{"start":{"row":136,"column":0},"end":{"row":137,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":136,"column":0},"end":{"row":137,"column":0},"action":"remove","lines":["",""],"id":10}],[{"start":{"row":137,"column":0},"end":{"row":151,"column":1},"action":"remove","lines":["function deleteIDOccurrence(req, res) {","    const id_occurrence = req.sanitize('id_occurrence').escape();","    let query = \"\";","    query = connect.con.query('DELETE from occurrence where id_occurrence=?', id_occurrence, function(err, rows, fields) {","        console.log(query.sql);","        if (!err) {","            console.log(\"Number of records affected: \" + rows.affectedRows);","            res.status(200).send({ \"msg\": \"deleted with success\" });","        }","        else {","            res.status(400).send({ \"msg\": err.code });","            console.log('Error while performing query', err);","        }","    });","}"],"id":11},{"start":{"row":136,"column":0},"end":{"row":137,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":136,"column":0},"end":{"row":137,"column":0},"action":"remove","lines":["",""],"id":12}],[{"start":{"row":859,"column":0},"end":{"row":859,"column":43},"action":"remove","lines":["    deleteIDOccurrence: deleteIDOccurrence,"],"id":13},{"start":{"row":858,"column":51},"end":{"row":859,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":177,"column":0},"end":{"row":194,"column":1},"action":"remove","lines":["function readOccurrenceFromOperational(req, res) {","    //criar e executar a query de leitura na BD","    const id_operational = req.sanitize('id_operational').escape();","    connect.con.query('SELECT * FROM operational_occurrence where id_operational=?', [id_operational], function(err,","        rows, fields) {","        if (!err) {","            //verifica os resultados se o número de linhas for 0 devolve dados não encontrados, caso contrário envia os resultados (rows).","            if (rows.length == 0) {","                res.status(404).send(\"Data not found\");","            }","            else {","                res.status(200).send(rows);","            }","        }","        else","            console.log('Error while performing Query.', err);","    });","}"],"id":14},{"start":{"row":176,"column":0},"end":{"row":177,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":176,"column":0},"end":{"row":177,"column":0},"action":"remove","lines":["",""],"id":15}],[{"start":{"row":223,"column":0},"end":{"row":250,"column":1},"action":"remove","lines":["//função de gravação que recebe os 5 parametros","function saveOperationalOccurrence(req, res) { // nao deve ser preciso","    //receber os dados do formuário que são enviados por post","    const statute = req.sanitize('statute').escape();","    const points = req.sanitize('points').escape();","    const arrival = req.sanitize('arrival').escape();","    const departure = req.sanitize('departure').escape();","    const presence = req.sanitize('presence').escape();","    const id_operational = req.sanitize('id_operational').escape();","    const id_occurrence = req.sanitize('id_occurrence').escape();","    let query = \"\";","    query = connect.con.query('INSERT INTO ?? VALUES (?,?,?,?,?,?,?)', [\"operational_occurrence\", statute, points, arrival, departure, presence, id_operational, id_occurrence], function(err, rows, fields) {","        console.log(query.sql);","        if (!err) {","            res.status(200).location(rows.insertId).send({","                \"msg\": \"inserted with success\"","            });","            console.log(\"Number of records inserted: \" + rows.affectedRows);","        }","        else {","            if (err.code == \"ER_DUP_ENTRY\") {","                res.status(409).send({ \"msg\": err.code });","                console.log('Error while performing Query.', err);","            }","            else res.status(400).send({ \"msg\": err.code });","        }","    });","}"],"id":16}],[{"start":{"row":222,"column":0},"end":{"row":223,"column":0},"action":"remove","lines":["",""],"id":17},{"start":{"row":221,"column":0},"end":{"row":222,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":223,"column":0},"end":{"row":245,"column":1},"action":"remove","lines":["function updateOperationalOccurrence(req, res) { // nao deve ser preciso","    //receber os dados do formuário que são enviados por post","    const statute = req.sanitize('statute').escape();","    const points = req.sanitize('points').escape();","    const arrival = req.sanitize('arrival').escape();","    const departure = req.sanitize('departure').escape();","    const presence = req.sanitize('presence').escape();","    const id_operational = req.sanitize('id_operational').escape();","    const id_occurrence = req.sanitize('id_occurrence').escape();","    let query = \"\";","    query = connect.con.query('Update ?? SET statute=?,points=?, arrival=?, departure=?,presence=? where id_operational=? and id_occurrence=?', [\"operational_occurrence\", statute, points, arrival, departure, presence, id_operational, id_occurrence], function(err, rows,","        fields) {","        console.log(query.sql);","        if (!err) {","            console.log(\"Number of records updated: \" + rows.affectedRows);","            res.status(200).send({ \"msg\": \"update with success\" });","        }","        else {","            res.status(400).send({ \"msg\": err.code });","            console.log('Error while performing Query.', err);","        }","    });","}"],"id":18},{"start":{"row":222,"column":0},"end":{"row":223,"column":0},"action":"remove","lines":["",""]},{"start":{"row":221,"column":0},"end":{"row":222,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":221,"column":0},"end":{"row":222,"column":0},"action":"remove","lines":["",""],"id":19}],[{"start":{"row":302,"column":0},"end":{"row":329,"column":0},"action":"remove","lines":["//função que apaga todos os dados de um operational_occurrence","function deleteIDOperationalOccurrence(req, res) { //nao deve ser preciso","    //criar e executar a query de leitura na BD","    const id_operational = req.sanitize('id_operational').escape();","    const id_occurrence = req.sanitize('id_occurrence').escape();","    const post = {","        id_operational: id_operational,","        id_occurrence: id_occurrence","    };","    connect.con.query('DELETE from operational_occurrence where id_operational = ? and id_occurrence=?', post, function(err, rows, fields) {","        if (!err) {","            //verifica os resultados se o número de linhas for 0 devolve dados não encontrados, caso contrário envia os resultados (rows).","            if (rows.length == 0) {","                res.status(404).send({","                    \"msg\": \"data not found\"","                });","            }","            else {","                res.status(200).send({","                    \"msg\": \"success\"","                });","            }","        }","        else","            console.log('Error while performing Query.', err);","    });","}",""],"id":20},{"start":{"row":301,"column":0},"end":{"row":302,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":301,"column":0},"end":{"row":302,"column":0},"action":"remove","lines":["",""],"id":21},{"start":{"row":300,"column":0},"end":{"row":301,"column":0},"action":"remove","lines":["",""]},{"start":{"row":299,"column":0},"end":{"row":300,"column":0},"action":"remove","lines":["",""]},{"start":{"row":298,"column":0},"end":{"row":299,"column":0},"action":"remove","lines":["",""]},{"start":{"row":297,"column":0},"end":{"row":298,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":297,"column":0},"end":{"row":298,"column":0},"action":"remove","lines":["",""],"id":22}],[{"start":{"row":764,"column":0},"end":{"row":764,"column":65},"action":"remove","lines":["    deleteIDOperationalOccurrence: deleteIDOperationalOccurrence,"],"id":23},{"start":{"row":763,"column":77},"end":{"row":764,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":757,"column":0},"end":{"row":759,"column":61},"action":"remove","lines":["    saveOperationalOccurrence: saveOperationalOccurrence,","    updateOperationalOccurrence: updateOperationalOccurrence,","    updateOperationalOccurrence: updateOperationalOccurrence,"],"id":24},{"start":{"row":756,"column":71},"end":{"row":757,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":446,"column":0},"end":{"row":463,"column":1},"action":"remove","lines":["//função de leitura que retorna o resultado de vehicle material occurrence no callback","function readVehicleMaterialOccurrence(req, res) {","    //criar e executar a query de leitura na BD","    connect.con.query('SELECT * FROM occur_vehic_material order by id_occurrence', function(err,","        rows, fields) {","        if (!err) {","            //verifica os resultados se o número de linhas for 0 devolve dados não encontrados, caso contrário envia os resultados (rows).","            if (rows.length == 0) {","                res.status(404).send(\"Data not found\");","            }","            else {","                res.status(200).send(rows);","            }","        }","        else","            console.log('Error while performing Query.', err);","    });","}"],"id":25}],[{"start":{"row":446,"column":0},"end":{"row":447,"column":0},"action":"remove","lines":["",""],"id":26}],[{"start":{"row":512,"column":0},"end":{"row":537,"column":1},"action":"remove","lines":["//função de gravação que recebe os parametros","function saveVehicleMaterialOccurrence(req, res) { // nao devemos usar","    //receber os dados do formuário que são enviados por post","    const id_occurrence = req.sanitize('id_occurrence').escape();","    const id_vei_mat = req.sanitize('id_vei_mat').escape();","    const utilization = req.sanitize('utilization').escape();","    const confirmation = req.sanitize('confirmation').escape();","    let query = \"\";","    //console.log(\"with hash:\" + hash);","    query = connect.con.query('INSERT INTO ?? VALUES (?,?,?,?)', [\"occur_vehic_material\", id_occurrence, id_vei_mat, utilization, confirmation], function(err, rows, fields) {","        console.log(query.sql);","        if (!err) {","            res.status(200).location(rows.insertId).send({","                \"msg\": \"inserted with success\"","            });","            console.log(\"Number of records inserted: \" + rows.affectedRows);","        }","        else {","            if (err.code == \"ER_DUP_ENTRY\") {","                res.status(409).send({ \"msg\": err.code });","                console.log('Error while performing Query.', err);","            }","            else res.status(400).send({ \"msg\": err.code });","        }","    });","}"],"id":27}],[{"start":{"row":512,"column":0},"end":{"row":513,"column":0},"action":"remove","lines":["",""],"id":28}],[{"start":{"row":553,"column":0},"end":{"row":579,"column":1},"action":"remove","lines":["//função que apaga todos os dados de um VehicleMaterialOccurrence","function deleteIDVehicleMaterialOccurrence(req, res) { // nao devemos uasr","    //criar e executar a query de leitura na BD","    const id_vei_mat = req.sanitize('id_vei_mat').escape();","    const id_occurrence = req.sanitize('id_occurrence').escape();","    const post = {","        id_vei_mat: id_vei_mat,","        id_occurrence: id_occurrence","    };","    connect.con.query('DELETE from occur_vehic_material where id_vei_mat = ? and id_occurrence=?', post, function(err, rows, fields) {","        if (!err) {","            //verifica os resultados se o número de linhas for 0 devolve dados não encontrados, caso contrário envia os resultados (rows).","            if (rows.length == 0) {","                res.status(404).send({","                    \"msg\": \"data not found\"","                });","            }","            else {","                res.status(200).send({","                    \"msg\": \"success\"","                });","            }","        }","        else","            console.log('Error while performing Query.', err);","    });","}"],"id":29},{"start":{"row":552,"column":0},"end":{"row":553,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":552,"column":0},"end":{"row":553,"column":0},"action":"remove","lines":["",""],"id":30}],[{"start":{"row":626,"column":0},"end":{"row":646,"column":1},"action":"remove","lines":["//efetuar updade de todos os dados para um determinado iduser","function updateNote(req, res) { // nao devemos uasr","    //receber os dados do formuário que são enviados por post","    const id_note = req.sanitize('id_note').escape();","    const description = req.sanitize('description').escape();","    const id_occurrence = req.sanitize('id_occurrence').escape();","    const time = req.sanitize('time').escape();","    let query = \"\";","    query = connect.con.query('Update ?? SET description =?, id_occurrence=?, time =?, where id_note=?', [\"note\", description, id_occurrence, time, id_note],","        function(err, rows, fields) {","            console.log(query.sql);","            if (!err) {","                console.log(\"Number of records updated: \" + rows.affectedRows);","                res.status(200).send({ \"msg\": \"update with success\" });","            }","            else {","                res.status(400).send({ \"msg\": err.code });","                console.log('Error while performing Query.', err);","            }","        });","}"],"id":31},{"start":{"row":625,"column":0},"end":{"row":626,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":625,"column":0},"end":{"row":626,"column":0},"action":"remove","lines":["",""],"id":32}],[{"start":{"row":675,"column":0},"end":{"row":675,"column":65},"action":"remove","lines":["    readVehicleMaterialOccurrence: readVehicleMaterialOccurrence,"],"id":33}],[{"start":{"row":679,"column":0},"end":{"row":679,"column":65},"action":"remove","lines":["    saveVehicleMaterialOccurrence: saveVehicleMaterialOccurrence,"],"id":34}],[{"start":{"row":682,"column":0},"end":{"row":682,"column":73},"action":"remove","lines":["    deleteIDVehicleMaterialOccurrence: deleteIDVehicleMaterialOccurrence,"],"id":35}],[{"start":{"row":687,"column":0},"end":{"row":687,"column":27},"action":"remove","lines":["    updateNote: updateNote,"],"id":36},{"start":{"row":686,"column":23},"end":{"row":687,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":678,"column":83},"end":{"row":679,"column":0},"action":"remove","lines":["",""],"id":37}]]},"ace":{"folds":[],"scrolltop":11617.5,"scrollleft":0,"selection":{"start":{"row":678,"column":83},"end":{"row":678,"column":83},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1608485974104,"hash":"4f138051d059d7f0d8379a628ec42ec1d737bb7a"}